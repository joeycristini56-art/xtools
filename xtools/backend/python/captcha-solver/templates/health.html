{% extends "base.html" %}

{% block title %}Health Check - XorthonL CAPTCHA Solver API{% endblock %}

{% block content %}
<div class="grid">
    <div class="card">
        <h2 class="card-title">
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M22 12h-4l-3 9L9 3l-3 9H2"></path>
            </svg>
            System Status
        </h2>
        <div class="card-content">
            <div class="status-indicator status-{{ 'healthy' if status == 'healthy' else 'error' }}">
                <span class="status-dot"></span>
                {{ status.title() }}
            </div>
            <div class="metric">
                <span class="metric-label">API Version</span>
                <span class="metric-value" data-metric="version">{{ version }}</span>
            </div>
            <div class="metric">
                <span class="metric-label">Uptime</span>
                <span class="metric-value" data-metric="uptime">{{ uptime_formatted }}</span>
            </div>
        </div>
    </div>

    <div class="card">
        <h2 class="card-title">
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="3"></circle>
                <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
            </svg>
            System Resources
        </h2>
        <div class="card-content">
            <div class="metric">
                <span class="metric-label">CPU Usage</span>
                <span class="metric-value" data-metric="cpu-usage">{{ "%.1f"|format(system_info.cpu_percent) }}%</span>
            </div>
            <div class="progress-bar" id="cpu-progress">
                <div class="progress-fill" style="width: {{ system_info.cpu_percent }}%"></div>
            </div>
            
            <div class="metric">
                <span class="metric-label">Memory Usage</span>
                <span class="metric-value" data-metric="memory-usage">{{ "%.1f"|format(system_info.memory_usage_mb) }} MB</span>
            </div>
            <div class="metric">
                <span class="metric-label">Memory Percentage</span>
                <span class="metric-value" data-metric="memory-percent">{{ "%.1f"|format(system_info.memory_percent) }}%</span>
            </div>
            <div class="progress-bar" id="memory-progress">
                <div class="progress-fill" style="width: {{ system_info.memory_percent }}%"></div>
            </div>
            
            <div class="metric">
                <span class="metric-label">Disk Usage</span>
                <span class="metric-value" data-metric="disk-usage">
                    {{ "%.1f"|format(system_info.disk_usage.used / (1024**3)) }} GB / 
                    {{ "%.1f"|format(system_info.disk_usage.total / (1024**3)) }} GB
                </span>
            </div>
        </div>
    </div>

    <div class="card">
        <h2 class="card-title">
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                <circle cx="8.5" cy="8.5" r="1.5"></circle>
                <path d="M21 15l-5-5L5 21"></path>
            </svg>
            Task Statistics
        </h2>
        <div class="card-content">
            <div class="metric">
                <span class="metric-label">Active Tasks</span>
                <span class="metric-value" data-metric="active-tasks">{{ task_stats.active or 0 }}</span>
            </div>
            <div class="metric">
                <span class="metric-label">Completed Tasks</span>
                <span class="metric-value" data-metric="completed-tasks">{{ task_stats.completed or 0 }}</span>
            </div>
            <div class="metric">
                <span class="metric-label">Failed Tasks</span>
                <span class="metric-value" data-metric="failed-tasks">{{ task_stats.failed or 0 }}</span>
            </div>
            <div class="metric">
                <span class="metric-label">Queue Size</span>
                <span class="metric-value" data-metric="queue-size">{{ task_stats.queue_size or 0 }}</span>
            </div>
        </div>
    </div>

    <div class="card">
        <h2 class="card-title">
            <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M9 12l2 2 4-4"></path>
                <path d="M21 12c-1 0-3-1-3-3s2-3 3-3 3 1 3 3-2 3-3 3"></path>
                <path d="M3 12c1 0 3-1 3-3s-2-3-3-3-3 1-3 3 2 3 3 3"></path>
            </svg>
            Solver Status
        </h2>
        <div class="card-content">
            <div class="metric">
                <span class="metric-label">Available Solvers</span>
                <span class="metric-value" data-metric="available-solvers">{{ solver_stats.available or 0 }}</span>
            </div>
            <div class="metric">
                <span class="metric-label">Total Solvers</span>
                <span class="metric-value" data-metric="total-solvers">{{ solver_stats.total or 0 }}</span>
            </div>
            {% if solver_stats.solvers %}
            <div style="margin-top: 1rem;">
                <h4 style="color: var(--purple-primary); margin-bottom: 0.5rem;">Active Solvers:</h4>
                <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                    {% for solver in solver_stats.solvers %}
                    <span class="status-indicator status-healthy" style="font-size: 0.8rem; padding: 0.25rem 0.5rem;">
                        {{ solver }}
                    </span>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<div class="card">
    <h2 class="card-title">
        <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 3v18h18"></path>
            <path d="M18.7 8l-5.1 5.2-2.8-2.7L7 14.3"></path>
        </svg>
        Performance Metrics
    </h2>
    <div class="card-content">
        <div class="grid">
            <div>
                <h4 style="color: var(--purple-primary); margin-bottom: 0.5rem;">Response Times</h4>
                <div class="metric">
                    <span class="metric-label">Average</span>
                    <span class="metric-value">{{ "%.2f"|format(performance_metrics.avg_response_time or 0) }}ms</span>
                </div>
                <div class="metric">
                    <span class="metric-label">95th Percentile</span>
                    <span class="metric-value">{{ "%.2f"|format(performance_metrics.p95_response_time or 0) }}ms</span>
                </div>
            </div>
            <div>
                <h4 style="color: var(--purple-primary); margin-bottom: 0.5rem;">Success Rates</h4>
                <div class="metric">
                    <span class="metric-label">Overall</span>
                    <span class="metric-value">{{ "%.1f"|format((performance_metrics.success_rate or 0) * 100) }}%</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Last Hour</span>
                    <span class="metric-value">{{ "%.1f"|format((performance_metrics.hourly_success_rate or 0) * 100) }}%</span>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
